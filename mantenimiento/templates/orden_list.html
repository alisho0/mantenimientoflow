{% extends "base.html" %}
{% block title %}Ã“rdenes de Trabajo{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2>Ã“rdenes de Trabajo</h2>
  {% if perms.mantenimiento.add_ordendetrabajo %}
    <a href="{% url 'crear_orden' %}" class="btn btn-success">â• Nueva Orden</a>
  {% endif %}
</div>

{% if ultima_orden %}
  <div class="alert alert-info">
    Ãšltima orden visualizada: <strong>#{{ ultima_orden }}</strong>
  </div>
{% endif %}

{% if ordenes %}
  <table class="table table-striped shadow-sm">
    <thead class="table-dark">
      <tr>
        <th>ID</th>
        <th>TÃ­tulo</th>
        <th>Prioridad</th>
        <th>Estado</th>
        <th>Operario</th>
        <th>Fecha</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      {% for orden in ordenes %}
      <tr {% if orden.id|stringformat:"s" == ultima_orden|stringformat:"s" %}class="table-info"{% endif %}>
        <td>{{ orden.id }}</td>
        <td>{{ orden.titulo }}</td>
        <td>{{ orden.prioridad }}</td>
        <td>{{ orden.estado }}</td>
        <td>{{ orden.operario_asignado }}</td>
        <td>{{ orden.fecha|date:"d/m/Y" }}</td>
        <td>
          {% if perms.mantenimiento.change_ordendetrabajo %}
            <a href="{% url 'asignar_orden' orden.id %}" class="btn btn-primary btn-sm">âœï¸ Editar</a>
          {% endif %}
          {% if perms.mantenimiento.add_consumosuministro %}
            <a href="{% url 'registrar_consumo' %}" class="btn btn-warning btn-sm">ğŸ§¾ Registrar Consumo</a>
          {% endif %}
          {% if perms.mantenimiento.delete_ordendetrabajo %}
            <button class="btn btn-danger btn-sm">ğŸ—‘ï¸ Eliminar</button>
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
{% else %}
  <div class="alert alert-secondary text-center">
    No hay Ã³rdenes registradas.
  </div>
{% endif %}
{% endblock %}
